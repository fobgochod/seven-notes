(window.webpackJsonp=window.webpackJsonp||[]).push([[78],{687:function(v,e,s){"use strict";s.r(e);var l=s(17),_=Object(l.a)({},(function(){var v=this,e=v.$createElement,s=v._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[s("h1",{attrs:{id:"redis-介绍及nio原理介绍"}},[v._v("redis 介绍及NIO原理介绍")]),v._v(" "),s("h2",{attrs:{id:"常识"}},[v._v("常识")]),v._v(" "),s("h3",{attrs:{id:"磁盘"}},[v._v("磁盘")]),v._v(" "),s("ul",[s("li",[v._v("寻址：ms")]),v._v(" "),s("li",[v._v("带宽：G/M")])]),v._v(" "),s("h3",{attrs:{id:"内存"}},[v._v("内存")]),v._v(" "),s("ul",[s("li",[v._v("寻址：ns (秒>毫秒>微秒>纳秒)")]),v._v(" "),s("li",[v._v("带宽：很大")])]),v._v(" "),s("blockquote",[s("p",[v._v("磁盘比内存在"),s("strong",[v._v("寻址")]),v._v("上慢了10万倍")])]),v._v(" "),s("ul",[s("li",[v._v("I/O buffer：成本问题")]),v._v(" "),s("li",[v._v("磁盘与磁道，扇区，一扇区512Byte带来一个成本变大：索引")]),v._v(" "),s("li",[v._v("4K 操作系统 无论你读多少，都是最少4K从磁盘拿")])]),v._v(" "),s("blockquote",[s("p",[v._v("随着文件变大，速度变慢，磁盘I/O成为瓶颈")])]),v._v(" "),s("h2",{attrs:{id:"数据库"}},[v._v("数据库")]),v._v(" "),s("p",[v._v("表很大，性能下降？ 增删改变慢 查询速度？")]),v._v(" "),s("ul",[s("li",[v._v("1个或者少量查询依然很快")]),v._v(" "),s("li",[v._v("并发大的时候受硬盘带宽影响速度")])]),v._v(" "),s("blockquote",[s("p",[v._v("SAP HAHA 内存级别的关系型数据库")])]),v._v(" "),s("h2",{attrs:{id:"缓存"}},[v._v("缓存")]),v._v(" "),s("blockquote",[s("p",[v._v("缓存 memcached、redis")])]),v._v(" "),s("ul",[s("li",[v._v("两个基础设施\n"),s("ul",[s("li",[v._v("冯诺依曼体系的硬件")]),v._v(" "),s("li",[v._v("以太网，TCP/IP网络")])])]),v._v(" "),s("li",[v._v("memcached\n"),s("ul",[s("li",[v._v("key=value")]),v._v(" "),s("li",[v._v("value没有类型的概念")])])]),v._v(" "),s("li",[v._v("redis\n"),s("ul",[s("li",[v._v("key=value")]),v._v(" "),s("li",[v._v("value=[Strings,Hashes,Lists,Sets,Sorted Sets]")]),v._v(" "),s("li",[v._v("Redis offers Strings, Hashes, Lists, Sets, Sorted Sets, Bitmaps, Bitfields, HyperLogLog, Geospatial indexes, and\nStreams as native data structures.")])])]),v._v(" "),s("li",[v._v("json可以表示很复杂的数据结构，世界上有三种数据表示\n"),s("ul",[s("li",[v._v("key=1,key=a")]),v._v(" "),s("li",[v._v("key=[1,2,3],key=[a,b,c]")]),v._v(" "),s("li",[v._v("key={x=y},key=[{a=1},{a=2}]")])])]),v._v(" "),s("li",[v._v("类型的意义（缓存k,v取回v中的某一个元素）\n"),s("ul",[s("li",[v._v("memcached返回value的所有数据到client\n"),s("ul",[s("li",[v._v("server网卡IO")]),v._v(" "),s("li",[v._v("client要有代码去解码")])])]),v._v(" "),s("li",[v._v("redis类型不是很重要\n"),s("ul",[s("li",[v._v("server中对每种类型都有自己的方法")]),v._v(" "),s("li",[v._v("index(),lpop")])])]),v._v(" "),s("li",[v._v("计算向数据移动(大数据)")])])])]),v._v(" "),s("h2",{attrs:{id:"数据库引擎"}},[v._v("数据库引擎")]),v._v(" "),s("p",[s("a",{attrs:{href:"https://db-engines.com/en",target:"_blank",rel:"noopener noreferrer"}},[v._v("https://db-engines.com/en"),s("OutboundLink")],1)]),v._v(" "),s("ul",[s("li",[v._v("Redis 秒级10万")]),v._v(" "),s("li",[v._v("关系型数据库 千级别")])]),v._v(" "),s("h2",{attrs:{id:"io变迁"}},[v._v("IO变迁")]),v._v(" "),s("ul",[s("li",[v._v("BIO\n"),s("ul",[s("li",[v._v("开启线程，一个线程对应一个连接，接收更多请求")]),v._v(" "),s("li",[v._v("内存成本 一个线程成本 1MB 可以调整")]),v._v(" "),s("li",[v._v("调度成本 CPU浪费")])])]),v._v(" "),s("li",[v._v("NIO\n"),s("ul",[s("li",[v._v("用户空间轮询socket，询问内核空间")]),v._v(" "),s("li",[v._v("一个线程 N个连接的系统调用")])])]),v._v(" "),s("li",[v._v("select、poll\n"),s("ul",[s("li",[v._v("每次传递大量文件描述符，内核轮询，返回有效文件描述符")]),v._v(" "),s("li",[v._v("用户态内核态传递数据成本高 N个连接就是N个文件描述符")])])]),v._v(" "),s("li",[v._v("epoll\n"),s("ul",[s("li",[v._v("epoll_create(),epoll_ctl(),epoll_wait()")]),v._v(" "),s("li",[v._v("共享空间")])])]),v._v(" "),s("li",[v._v("kafka\n"),s("ul",[s("li",[v._v("mmap 共享空间")]),v._v(" "),s("li",[v._v("sendfile 减少用户内核拷贝 零拷贝")])])]),v._v(" "),s("li",[v._v("nginx\n"),s("ul",[s("li",[v._v("多少颗CPU启动多少个进程 worker")]),v._v(" "),s("li",[v._v("kernel的epoll的同步非阻塞多路复用")])])])]),v._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[v._v("# 允许的最大连接数")]),v._v("\nCONFIG GET maxclients\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[v._v("# 当前的redis连接数")]),v._v("\ninfo clients\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[v._v("# 获取客户端列表")]),v._v("\nCLIENT LIST\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[v._v("# 查看当前连接的名称")]),v._v("\nCLIENT GETNAME\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[v._v("# 查看超时配置")]),v._v("\nconfig get "),s("span",{pre:!0,attrs:{class:"token function"}},[v._v("timeout")]),v._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[v._v("# 杀死指定连接")]),v._v("\nCLIENT KILL ip:port\n")])]),v._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[v._v("1")]),s("br"),s("span",{staticClass:"line-number"},[v._v("2")]),s("br"),s("span",{staticClass:"line-number"},[v._v("3")]),s("br"),s("span",{staticClass:"line-number"},[v._v("4")]),s("br"),s("span",{staticClass:"line-number"},[v._v("5")]),s("br"),s("span",{staticClass:"line-number"},[v._v("6")]),s("br"),s("span",{staticClass:"line-number"},[v._v("7")]),s("br"),s("span",{staticClass:"line-number"},[v._v("8")]),s("br"),s("span",{staticClass:"line-number"},[v._v("9")]),s("br"),s("span",{staticClass:"line-number"},[v._v("10")]),s("br"),s("span",{staticClass:"line-number"},[v._v("11")]),s("br"),s("span",{staticClass:"line-number"},[v._v("12")]),s("br")])])])}),[],!1,null,null,null);e.default=_.exports}}]);