(window.webpackJsonp=window.webpackJsonp||[]).push([[51],{670:function(l,s,e){"use strict";e.r(s);var v=e(17),t=Object(v.a)({},(function(){var l=this,s=l.$createElement,e=l._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":l.$parent.slotKey}},[e("h1",{attrs:{id:"网络编程之多路复用器及epoll精讲"}},[l._v("网络编程之多路复用器及Epoll精讲")]),l._v(" "),e("h2",{attrs:{id:"多路复用器"}},[l._v("多路复用器")]),l._v(" "),e("ul",[e("li",[l._v("多条 路(IO)通过一个系统调用，获得其中的IO"),e("code",[l._v("状态")]),l._v("，然后由程序自己对有状态的IO进行R/W")]),l._v(" "),e("li",[l._v("IO模型是同步的")])]),l._v(" "),e("blockquote",[e("p",[l._v("只关注IO：不关注从IO读写完之后的事情")])]),l._v(" "),e("ul",[e("li",[e("p",[l._v("同步：app自己R/W")])]),l._v(" "),e("li",[e("p",[l._v("异步：kernel完成R/W 没有访问IO Buffer win:iocp")])]),l._v(" "),e("li",[e("p",[l._v("阻塞：BLOCKING")])]),l._v(" "),e("li",[e("p",[l._v("非阻塞：NONBLOCKING")])])]),l._v(" "),e("blockquote",[e("p",[l._v("linux以及成熟的框架 netty")])]),l._v(" "),e("ul",[e("li",[l._v("同步阻塞：程序自己读取，调用了方法一直等待有效返回结果")]),l._v(" "),e("li",[l._v("同步非阻塞：程序自己读取，调用方法一瞬间给出是否读到（自己要解决下次啥时候去读）")]),l._v(" "),e("li",[l._v("异步：尽量不讨论，因为现在我们只讨论IO模型下，linux，目前没有通用的异步处理方案")])]),l._v(" "),e("h3",{attrs:{id:"多路复用器-2"}},[l._v("多路复用器")]),l._v(" "),e("ul",[e("li",[e("p",[l._v("SELECT POSIX标准")])]),l._v(" "),e("li",[e("p",[l._v("POLL")])]),l._v(" "),e("li",[e("p",[l._v("EPOLL")])]),l._v(" "),e("li",[e("p",[l._v("linux epoll")])]),l._v(" "),e("li",[e("p",[l._v("unix kqueue")])])]),l._v(" "),e("h4",{attrs:{id:"select"}},[l._v("SELECT")]),l._v(" "),e("ul",[e("li",[l._v("文档：man 2 select")]),l._v(" "),e("li",[l._v("synchronous I/O multiplexing")]),l._v(" "),e("li",[l._v("FD_SETSIZE(1024)")])]),l._v(" "),e("h4",{attrs:{id:"poll"}},[l._v("POLL")]),l._v(" "),e("ul",[e("li",[l._v("文档：man 2 poll")]),l._v(" "),e("li",[l._v("没有FD_SETSIZE限制")])]),l._v(" "),e("h4",{attrs:{id:"总结"}},[l._v("总结")]),l._v(" "),e("h5",{attrs:{id:"nio、select、poll都是要遍历所有的io-询问状态"}},[l._v("NIO、SELECT、POLL都是要遍历所有的IO，询问状态")]),l._v(" "),e("ul",[e("li",[l._v("NIO: 这个遍历的成本在用户态内核态切换")]),l._v(" "),e("li",[l._v("SELECT、POLL: 这个遍历过程触发一次系统调用，用户态内核态切换过程中，把fds传递给内核，由内核来遍历修改状态")])]),l._v(" "),e("h5",{attrs:{id:"多路复用器-select-poll的弊端"}},[l._v("多路复用器：select poll的弊端：")]),l._v(" "),e("ul",[e("li",[l._v("每次都要重新，重复传递fds(内核开辟空间)")]),l._v(" "),e("li",[l._v("每次内核被调用后，针对这次调用，触发一个遍历fds全量的复杂度")])]),l._v(" "),e("blockquote",[e("p",[l._v("时钟中断 晶振")])]),l._v(" "),e("ul",[e("li",[l._v("EPOLL之前callback 只是完成了将网卡发来的数据，走内核的网络协议栈(2、3、4)最终关联到fd的buffer，")]),l._v(" "),e("li",[l._v("所以你某一时间从APP询问内核某一个或多个fd是否可R/W，会有状态返回")])]),l._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[l._v("yum "),e("span",{pre:!0,attrs:{class:"token function"}},[l._v("install")]),l._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[l._v("man")]),l._v(" man-pages\n\n"),e("span",{pre:!0,attrs:{class:"token function"}},[l._v("cat")]),l._v(" /proc/sys/fs/epoll/max_user_watches\n")])]),l._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[l._v("1")]),e("br"),e("span",{staticClass:"line-number"},[l._v("2")]),e("br"),e("span",{staticClass:"line-number"},[l._v("3")]),e("br")])]),e("ul",[e("li",[l._v("man 2 epoll_create")]),l._v(" "),e("li",[l._v("man 2 epoll_ctl")]),l._v(" "),e("li",[l._v("man 2 epoll_wait")])]),l._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[l._v("-Djava.nio.channels.spi.SelectorProvider"),e("span",{pre:!0,attrs:{class:"token operator"}},[l._v("=")]),l._v("sun.nio.ch.PollSelectorProvider\n-Djava.nio.channels.spi.SelectorProvider"),e("span",{pre:!0,attrs:{class:"token operator"}},[l._v("=")]),l._v("sun.nio.ch.EPollSelectorProvider\n\n"),e("span",{pre:!0,attrs:{class:"token function"}},[l._v("strace")]),l._v(" -ff -o out java -Djava.nio.channels.spi.SelectorProvider"),e("span",{pre:!0,attrs:{class:"token operator"}},[l._v("=")]),l._v("sun.nio.ch.PollSelectorProvider SocketNIO\n")])]),l._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[l._v("1")]),e("br"),e("span",{staticClass:"line-number"},[l._v("2")]),e("br"),e("span",{staticClass:"line-number"},[l._v("3")]),e("br"),e("span",{staticClass:"line-number"},[l._v("4")]),e("br")])])])}),[],!1,null,null,null);s.default=t.exports}}]);