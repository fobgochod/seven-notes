(window.webpackJsonp=window.webpackJsonp||[]).push([[75],{526:function(a,s,t){"use strict";t.r(s);var e=t(4),n=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"jvm"}},[a._v("JVM")]),a._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://docs.oracle.com/javase/specs/index.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("Java Language and Virtual Machine Specifications"),s("OutboundLink")],1)]),a._v(" "),s("li",[s("a",{attrs:{href:"https://docs.oracle.com/javase/8/docs/technotes/tools/windows/java.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("JDK8启动参数-Windows"),s("OutboundLink")],1)]),a._v(" "),s("li",[s("a",{attrs:{href:"https://docs.oracle.com/javase/8/docs/technotes/tools/unix/java.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("JDK8启动参数-UNIX"),s("OutboundLink")],1)]),a._v(" "),s("li",[s("a",{attrs:{href:"https://docs.oracle.com/en/java/javase/17/docs/specs/man/java.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("JDK17启动参数"),s("OutboundLink")],1)])]),a._v(" "),s("h3",{attrs:{id:"jvm配置参数分类"}},[a._v("JVM配置参数分类")]),a._v(" "),s("h5",{attrs:{id:"standard-options"}},[a._v("Standard Options(-)")]),a._v(" "),s("blockquote",[s("p",[a._v("These are the most commonly used options that are supported by all implementations of the JVM.")])]),a._v(" "),s("h5",{attrs:{id:"non-standard-options-x"}},[a._v("Non-Standard Options(-X)")]),a._v(" "),s("blockquote",[s("p",[a._v("These options are general purpose options that are specific to the Java HotSpot Virtual Machine.")])]),a._v(" "),s("h5",{attrs:{id:"advanced-runtime-options-xx"}},[a._v("Advanced Runtime Options(-XX)")]),a._v(" "),s("blockquote",[s("p",[a._v("These options control the runtime behavior of the Java HotSpot VM.")])]),a._v(" "),s("h3",{attrs:{id:"查看参数"}},[a._v("查看参数")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 是打印所有的默认参数设置")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-XX:+PrintFlagsInitial")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 是打印最终值，如果某个默认值被新值覆盖，显示新值")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-XX:+PrintFlagsFinal")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 是打印那些被新值覆盖的项")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-XX:+PrintCommandLineFlags")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("java")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-XX:+PrintFlagsInitial")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("java")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-XX:+PrintFlagsFinal")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-version")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("grep")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('":"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("java")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-XX:+PrintCommandLineFlags")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-version")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br")])]),s("p",[a._v("格式如下： Type | Name | Operator | Value | Application")]),a._v(" "),s("ul",[s("li",[a._v("product – 官方支持, JVM内部选项")]),a._v(" "),s("li",[a._v("rw – 可动态写入的.")]),a._v(" "),s("li",[a._v("C1 – Client JIT 编译器")]),a._v(" "),s("li",[a._v("C2 – Server JIT 编译器")]),a._v(" "),s("li",[a._v("pd – platform Dependent 平台独立")]),a._v(" "),s("li",[a._v("lp64 – 仅 64 位JVM")]),a._v(" "),s("li",[a._v("manageable – 外部定义的并且是可动态写入的.")]),a._v(" "),s("li",[a._v("diagnostic – 用于虚拟机debug的")]),a._v(" "),s("li",[a._v("experimental – 非官方支持的")])]),a._v(" "),s("h3",{attrs:{id:"内存区域"}},[a._v("内存区域")]),a._v(" "),s("p",[s("img",{attrs:{src:"/images/jvm/jvm-1.png",alt:""}})]),a._v(" "),s("ul",[s("li",[a._v("控制参数详解\n"),s("ul",[s("li",[a._v("-Xms设置堆的最小空间大小。")]),a._v(" "),s("li",[a._v("-Xmx设置堆的最大空间大小。")]),a._v(" "),s("li",[a._v("-Xmn堆中新生代初始及最大大小（NewSize和MaxNewSize为其细化）。")]),a._v(" "),s("li",[a._v("-XX:NewSize设置新生代最小空间大小。")]),a._v(" "),s("li",[a._v("-XX:MaxNewSize设置新生代最大空间大小。")]),a._v(" "),s("li",[a._v("-XX:PermSize设置永久代最小空间大小。")]),a._v(" "),s("li",[a._v("-XX:MaxPermSize设置永久代最大空间大小。")]),a._v(" "),s("li",[a._v("-Xss设置每个线程的堆栈大小。")])])])]),a._v(" "),s("p",[a._v("-XX:NewRatio=2")]),a._v(" "),s("ul",[s("li",[a._v("默认 -XX:NewRatio=2 新生代占1,老年代占2,年轻代占整个堆的1/3")]),a._v(" "),s("li",[a._v("假如 -XX:NewRatio=4 新生代占1,老年代占4,年轻代占整个堆的1/5")])]),a._v(" "),s("p",[a._v("-XX:SurvivorRatio=8")]),a._v(" "),s("ul",[s("li",[a._v("默认 -XX:SurvivorRatio=8 Eden:S0:S1=8:1:1")]),a._v(" "),s("li",[a._v("假如 -XX:SurvivorRatio=4 Eden:S0:S1=4:1:1")])]),a._v(" "),s("p",[a._v("-XX:-UseAdaptiveSizePolicy")]),a._v(" "),s("ul",[s("li",[a._v("开启：-XX:+UseAdaptiveSizePolicy")]),a._v(" "),s("li",[a._v("关闭：-XX:-UseAdaptiveSizePolicy")])]),a._v(" "),s("blockquote",[s("p",[a._v("说明：-XX:NewRatio=默认值是2、-Xmn优先级高于-XX:NewRatio")])]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("java")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-Xms30M")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-Xmx30m")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-XX:+PrintFlagsFinal")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-version")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("grep")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-E")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'(Old|New)Size'")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("java")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-Xms30M")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-Xmx30m")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-XX:NewRatio")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-XX:+PrintFlagsFinal")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-version")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("grep")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-E")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'(Old|New)Size'")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("java")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-Xms30M")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-Xmx30m")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-XX:NewRatio")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-Xmn20M")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-XX:+PrintFlagsFinal")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-version")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("grep")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-E")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'(Old|New)Size'")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])]),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-verbose:gc")]),a._v("  \n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-XX:+PrintGCDetails")]),a._v("  \n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-XX:+PrintGCDateStamps")]),a._v("  \n-Xloggc:E:"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("gc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("gc.log\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br")])]),s("h3",{attrs:{id:"jvm问题排查"}},[a._v("JVM问题排查")]),a._v(" "),s("blockquote",[s("p",[a._v("查看进程ID")])]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@fobgochod ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# jps -l")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1413")]),a._v(" sun.tools.jps.Jps\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 堆内存分布")]),a._v("\njmap "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-heap")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1413")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# GC信息")]),a._v("\njstat "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-gcutil")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1413")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1000")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("5")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 导出堆信息")]),a._v("\njmap "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-dump:format")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("b,file"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("heap_dump.hprof "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1413")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 导出线程栈")]),a._v("\njstack "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1413")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" jstack.txt\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br")])]),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 查看进程1413中最耗cpu的子线程")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("top")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1413")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-H")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 将最耗cpu的线程ID转换为16进制输出")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@fobgochod ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v('# printf "%x \\n" 1413')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("585")]),a._v(" \n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 查询具体出现问题的代码位置")]),a._v("\njstack "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("23219")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("grep")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("585")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("30")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br")])]),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 查看java线程数")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ps")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-eLf")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("grep")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("java")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("wc")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-l")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 监控网络客户连接数")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("netstat")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-n")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("grep")]),a._v(" tcp "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("grep")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8080")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("wc")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-l")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 查一下tcp连接情况")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("netstat")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-n")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("awk")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'/^tcp/ {++S[$NF]} END {for(a in S) print a, S[a]}'")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br")])])])}),[],!1,null,null,null);s.default=n.exports}}]);